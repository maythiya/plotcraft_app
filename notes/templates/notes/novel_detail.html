{% extends "base.html" %}
{% load static %}

{% block title %}{{ novel.title }} | Dashboard{% endblock %}

{% block content %}
<div class="min-h-screen bg-[#F8F9FA] font-sans pb-12">
    
    <div class="h-1.5 w-full bg-gradient-to-r from-[#2F4F4F] via-[#2F4F4F] to-[#DAA520]"></div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        
        <nav class="text-sm mb-6 text-gray-500 flex items-center gap-2">
            <a href="{% url 'notes:novel_list' %}" class="hover:text-[#2F4F4F] transition flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                My Novels
            </a>
            <span class="text-gray-300">/</span>
            <span class="text-[#2F4F4F] font-semibold truncate max-w-[200px]">{{ novel.title }}</span>
        </nav>

        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mb-8 relative group">
            <div class="absolute top-0 right-0 w-64 h-64 bg-[#DAA520]/5 rounded-full blur-3xl -mr-20 -mt-20 pointer-events-none transition-opacity opacity-50 group-hover:opacity-100"></div>

            <div class="p-6 md:p-10 flex flex-col md:flex-row gap-8 relative z-10">
                
                <div class="w-full md:w-52 flex-shrink-0">
                    <div class="aspect-[2/3] rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden bg-gray-100 border border-gray-200 relative">
                        {% if novel.cover_image %}
                            <img src="{{ novel.cover_image.url }}" class="w-full h-full object-cover">
                        {% else %}
                            <div class="w-full h-full flex flex-col items-center justify-center text-gray-300 bg-gray-50">
                                <span class="text-5xl mb-2">üìñ</span>
                                <span class="text-xs text-gray-400">No Cover</span>
                            </div>
                        {% endif %}
                        
                        <div class="absolute top-2 right-2 px-2 py-1 rounded text-[10px] font-bold text-white shadow-sm
                            {% if novel.status == 'ONGOING' %}bg-green-500{% else %}bg-blue-500{% endif %}">
                            {{ novel.get_status_display }}
                        </div>
                    </div>
                </div>

                <div class="flex-1 flex flex-col">
                    <div class="flex flex-wrap items-center gap-3 mb-3">
                        <span class="px-2.5 py-0.5 rounded-full bg-[#2F4F4F]/10 text-[#2F4F4F] text-xs font-bold uppercase tracking-wide">
                            {{ novel.get_category_display }}
                        </span>
                        <span class="px-2.5 py-0.5 rounded-full border border-gray-200 text-gray-500 text-xs font-medium">
                            Rating: {{ novel.get_rating_display }}
                        </span>
                    </div>

                    <h1 class="text-3xl md:text-4xl font-extrabold text-[#2F4F4F] tracking-tight mb-4 leading-tight">
                        {{ novel.title }}
                    </h1>

                    <div class="bg-gray-50 rounded-xl p-4 mb-6 border border-gray-100 relative">
                        <svg class="w-8 h-8 text-gray-200 absolute -top-3 -left-2 bg-gray-50 rounded-full" fill="currentColor" viewBox="0 0 24 24"><path d="M14.017 21L14.017 18C14.017 16.896 14.321 16.067 14.929 15.513C15.537 14.96 16.516 14.656 17.867 14.6L18.475 14.6L18.475 6L14.475 6L14.475 11.5L9.5 11.5L9.5 6L5.5 6L5.5 14.6L6.108 14.6C7.459 14.656 8.438 14.96 9.046 15.513C9.654 16.067 9.958 16.896 9.958 18L9.958 21L14.017 21Z" /></svg>
                        <p class="text-gray-600 text-sm md:text-base leading-relaxed pl-2 relative z-10 font-serif">
                            {{ novel.synopsis|default:"‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡πÇ‡∏õ‡∏£‡∏¢..."|linebreaksbr }}
                        </p>
                    </div>

                    <div class="mt-auto flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 pt-4 border-t border-gray-100">
                        <div class="text-xs text-gray-400 flex items-center gap-4">
                            <span class="flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: {{ novel.updated_at|date:"d M Y H:i" }}
                            </span>
                            <span class="flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                                ‡πÇ‡∏î‡∏¢ {{ novel.author.username }}
                            </span>
                        </div>
                        
                        <a href="{% url 'notes:novel_edit' pk=novel.id %}" 
                           class="text-sm font-bold text-[#2F4F4F] hover:text-[#DAA520] transition flex items-center gap-1 px-4 py-2 hover:bg-gray-50 rounded-lg">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 md:p-8">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
                <h2 class="text-2xl font-bold text-[#2F4F4F] flex items-center gap-3">
                    <span class="bg-[#2F4F4F] text-white p-1.5 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
                    </span>
                    ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ï‡∏≠‡∏ô
                    <span class="text-sm font-normal text-gray-400 ml-2">({{ chapters.count }} ‡∏ï‡∏≠‡∏ô)</span>
                </h2>
                
                <a href="{% url 'notes:chapter_create' novel.id %}" 
                   class="group bg-[#DAA520] hover:bg-[#b8860b] text-white px-6 py-2.5 rounded-xl font-bold shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-0.5 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà
                </a>
            </div>

            {% if chapters %}
            <div class="border border-gray-100 rounded-xl overflow-hidden">
                <ul class="divide-y divide-gray-100">
                    {% for chapter in chapters %}
                    <li class="p-4 hover:bg-[#FAF9F6] transition-colors duration-200 flex items-center justify-between group relative">
                        <div class="flex items-center gap-4 md:gap-6 flex-1">
                            <div class="flex-shrink-0 w-12 h-12 rounded-xl bg-gray-50 text-[#2F4F4F] font-bold text-lg flex items-center justify-center border border-gray-100 group-hover:border-[#DAA520] group-hover:text-[#DAA520] transition-colors">
                                {{ chapter.order }}
                            </div>
                            
                            <div class="flex-1 min-w-0">
                                <h3 class="font-bold text-gray-800 text-lg group-hover:text-[#2F4F4F] transition-colors mb-1 truncate pr-4">
                                    {{ chapter.title }}
                                </h3>
                                <div class="flex items-center gap-3 text-xs text-gray-400">
                                    <span>{{ chapter.updated_at|date:"d M Y" }}</span>
                                    <span class="w-1 h-1 rounded-full bg-gray-300"></span>
                                    <span>{{ chapter.content|striptags|cut:" "|length }} ‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pl-4">
                            <a href="{% url 'notes:chapter_edit' novel.id chapter.id %}" class="p-2 text-gray-400 hover:text-[#DAA520] hover:bg-[#DAA520]/10 rounded-lg transition" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                            </a>
                            <form action="{% url 'notes:chapter_delete' chapter.id %}" method="POST" onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏ï‡∏≠‡∏ô {{ chapter.title }}?');">
                                {% csrf_token %}
                                <button type="submit" class="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition" title="‡∏•‡∏ö">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </form>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% else %}
            <div class="rounded-xl border-2 border-dashed border-gray-200 p-12 text-center bg-gray-50/50 flex flex-col items-center">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-gray-400">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                </div>
                <h3 class="text-lg font-bold text-gray-700 mb-1">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</h3>
                <p class="text-gray-500 text-sm mb-6">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ö‡∏ó‡∏ô‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
                <a href="{% url 'notes:chapter_create' novel.id %}" class="px-6 py-2 bg-[#2F4F4F] text-[#FAEBD7] rounded-lg text-sm font-bold hover:bg-[#1a3030] transition shadow-md">
                    ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏¢
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}